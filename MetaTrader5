import time
import MetaTrader5 as mt5

SYMBOL = "EURUSD"
LOT = 0.01

if not mt5.initialize():
    print("MT5 initialization failed:", mt5.last_error())
    quit()

mt5.symbol_select(SYMBOL, True)

def open_trade(order_type):
    price = mt5.symbol_info_tick(SYMBOL).ask if order_type == mt5.ORDER_TYPE_BUY else mt5.symbol_info_tick(SYMBOL).bid
    request = {
        "action": mt5.TRADE_ACTION_DEAL,
        "symbol": SYMBOL,
        "volume": LOT,
        "type": order_type,
        "price": price,
        "deviation": 20,
    }
    return mt5.order_send(request)

def close_trade(ticket, order_type):
    price = mt5.symbol_info_tick(SYMBOL).bid if order_type == mt5.ORDER_TYPE_BUY else mt5.symbol_info_tick(SYMBOL).ask
    request = {
        "action": mt5.TRADE_ACTION_DEAL,
        "position": ticket,
        "symbol": SYMBOL,
        "volume": LOT,
        "type": mt5.ORDER_TYPE_SELL if order_type == mt5.ORDER_TYPE_BUY else mt5.ORDER_TYPE_BUY,
        "price": price,
        "deviation": 20
    }
    return mt5.order_send(request)

for i in range(10):
    direction = mt5.ORDER_TYPE_BUY if i % 2 == 0 else mt5.ORDER_TYPE_SELL

    open_result = open_trade(direction)
    print("Opened:", open_result)

    time.sleep(0.2)

    if open_result and open_result.ticket:
        close_result = close_trade(open_result.order, direction)
        print("Closed:", close_result)

    time.sleep(0.1)

mt5.shutdown()
